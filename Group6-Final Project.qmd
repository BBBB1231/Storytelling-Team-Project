---
title: "Tesla Back On Track: In-depth analytics to uncover potential markets and raise market share"
to:
  - name: Mark Kyle Castro
    role: "Chief Marketing/Sales Officer"
    company: Tesla
authors:
  - name: Ben Hsiao (5133) 
    role: "Student"
    email: jh5133@columbia.edu 
    affiliations:
      - name: Columbia University
  - name: Agustina Kohen (5501)
    role: "Student"
    email: ak5501@columbia.edu
    affiliations:
      - name: Columbia University
  - name: ZixiaoXu (2569)
    role: "Student"
    email: zx2569@columbia.edu
    affiliations:
      - name: Columbia University
date: 12/3/2025
date-format: long
format:
  pdf:
    toc: true
    number-sections: true
    colorlinks: true
  html:
    toc: true
    number-sections: true
    code-fold: show
    code-tools: true
    code-link: true
    theme:
      light: flatly
      dark: darkly
    embed-resources: true
filters:
  - scrolly
execute:
  eval: true
  warning: false
  message: false
  error: false
  echo: true
---

# Preliminary setup {-}

Load libraries to access functions we'll use in this analysis.

```{r}
library(tidyverse)
library(plotly)
library(readxl) 
library(stringr)
```


# Introduction

Road transportation is a major contributor to urban air pollution, and recent data indicate that cars and vans account for 48% of global transportation CO₂ emissions—the largest share among all transportation modes [5]. As Tesla works to accelerate the transition to sustainable energy, this challenge also highlights a strategic opportunity: **many of the most polluted U.S. regions continue to have low EV adoption and limited charging access, restricting both environmental gains and market growth.**

To fully understand the strategic potential of this analysis, it is important to consider current EV adoption trends and the specific information gaps that constrain Tesla’s ability to seize these opportunities. Tesla has proven to be an innovative and leading organization in the transportation sector. Tesla's brand is viewed as both luxurious and sustainable, appealing to a diverse range of customers. However, as the end of the year approaches, the EV market share in the United States had decreased to 7.4% by Q2 2025, indicating a year-over-year decline. Tesla’s market share in the EV market increased to 46%, but sales continue to decline by 10% annually [4]. The growth of sustainability-conscious consumers should lead to a boost in the EV market. 

## The approach

Tesla currently lacks a data-driven approach that compares the US counties with high air pollution and low EV adoption. To address this gap, let us delve into a data analysis that combines EPA Air Quality System (AQS) data, Department of Energy EV registration data, and charging infrastructure records, thereby providing a holistic understanding of how EV adoption relates to air-quality improvements and validating these patterns across regions. The resulting insights will guide Supercharger placement, targeted marketing, and public-sector partnerships—helping Tesla prioritize high-impact, underserved markets while advancing measurable progress toward its sustainability mission.

## Understanding the data

For the purpose of this analysis, we will primarily work with three datasets. One is the EPA’s Air Quality System (AQS), which includes PM2.5, NO₂, and daily AQI readings. The next one is EV-registration data from the Department of Energy. The last one is public EV charging station data, also from the Department of Energy. Our first step is to clean all datasets, match the time periods, and align them using the same geographic identifiers so that the regions correspond correctly. 

Next, we will examine **three key questions:** 
- Which states represent the highest-opportunity markets for Tesla? (given their high pollution and low EV adoption)
- Is the infrastructure gap closing? How does the growth of EV charging stations compare to other alternative energy solutions (like CNG, Biodiesel, or Hydrogen)?
- How can changing the station infrastructure affect pollution and Tesla's revenue?

# Interactive Graph #1: Pollution vs. EV Adoption Opportunity Map

**Key Question:** Which states show the largest mismatch between pollution levels and EV adoption—highlighting where Tesla should accelerate Supercharger deployment?

### Data Processing Strategy
This visualization merges state-level PM2.5 pollution averages with EV adoption per 100k residents. After cleaning the data and removing states with missing values, each state was classified into four quadrants based on whether it falls above or below the national averages for pollution and EV adoption.

```{r}
# Read cleaned EV + Population data
ev_state <- read_csv(
  "ev_state_cleaned.csv",
  show_col_types = FALSE
)

print("EV + population cleaned data:")
head(ev_state)

# Read Api data
aqi_raw <- read_csv(
  "Pollution.csv",
  show_col_types = FALSE
)

head(aqi_raw, 20)
colnames(aqi_raw)

aqi_clean <- aqi_raw %>%
  
  rename(
    state   = `Air Quality Statistics by County, 2023`,
    county  = ...2,
    fips    = ...3,
    population = ...4,
    pm25    = ...12     
  ) %>%
  
  filter(!is.na(state), state != "State") %>%
  
  mutate(
    pm25 = na_if(pm25, "ND"),
    pm25 = as.numeric(pm25)
  ) %>%
  
 
  group_by(state) %>%
  summarise(
    pm25 = mean(pm25, na.rm = TRUE),
    .groups = "drop"
  )

print("Cleaned AQI (PM2.5) data:")
head(aqi_clean)

#merged two data
merged_state <- ev_state %>%
  left_join(aqi_clean, by = "state") %>%
  mutate(
    pollution_ev_gap = pm25 - ev_per_100k/100
  )

head(merged_state)


# Fig 1

install.packages("dplyr")
library(dplyr)
library(plotly)

# 1. Keep whole data
merged_plot <- merged_state %>%
  filter(!is.na(pm25), !is.na(ev_per_100k))

# 2.Comupute the mean
mean_pm25 <- mean(merged_plot$pm25, na.rm = TRUE)
mean_ev   <- mean(merged_plot$ev_per_100k, na.rm = TRUE)

#3. Define the state
merged_plot <- merged_plot %>%
  mutate(
    zone = case_when(
      pm25 >= mean_pm25 & ev_per_100k <= mean_ev ~
        "High pollution / Low EV (Opportunity)",
      pm25 >= mean_pm25 & ev_per_100k >  mean_ev ~
        "High pollution / High EV",
      pm25 <  mean_pm25 & ev_per_100k <= mean_ev ~
        "Low pollution / Low EV",
      TRUE ~ "Low pollution / High EV"
    )
  )

# 4. Prepare for Loess line.
loess_fit <- loess(ev_per_100k ~ pm25, data = merged_plot, span = 0.75)
pm25_seq  <- seq(min(merged_plot$pm25), max(merged_plot$pm25), length.out = 200)
ev_pred   <- predict(loess_fit, newdata = data.frame(pm25 = pm25_seq))

line_df <- data.frame(
  pm25 = pm25_seq,
  ev   = ev_pred
)

# 5.Plot
fig1 <- plot_ly(
  data = merged_plot,
  x = ~pm25,
  y = ~ev_per_100k,
  type = "scatter",
  mode = "markers",
  color = ~zone,                    
  colors = c("#d73027","#fc8d59","#91bfdb","#4575b4"),
  marker = list(
    size = ~ (population / max(population)) * 25 + 5,  
    opacity = 0.85,
    line = list(color = "white", width = 0.5)
  ),
  text = ~paste(
    "State:", state,
    "<br>Zone:", zone,
    "<br>PM2.5:", round(pm25, 1),
    "<br>EV per 100k:", round(ev_per_100k, 0),
    "<br>Population:", format(population, big.mark = ",")
  ),
  hoverinfo = "text"
) %>%
  layout(
    title = "High Pollution vs Low EV Adoption by State",
    xaxis = list(title = "PM2.5 Pollution Level"),
    yaxis = list(title = "EV Adoption per 100k"),
    legend = list(title = list(text = "State segment")),
    shapes = list(
     
      list(
        type = "line",
        x0 = mean_pm25, x1 = mean_pm25,
        y0 = 0, y1 = max(merged_plot$ev_per_100k, na.rm = TRUE),
        line = list(dash = "dash", color = "grey")
      ),
      
      list(
        type = "line",
        x0 = 0, x1 = max(merged_plot$pm25, na.rm = TRUE),
        y0 = mean_ev, y1 = mean_ev,
        line = list(dash = "dash", color = "grey")
      )
    ),
    
    annotations = list(
      list(
        x = max(merged_plot$pm25, na.rm = TRUE),
        y = mean_ev * 0.4,
        text = "High pollution<br>Low EV = Tesla\nopportunity",
        showarrow = FALSE,
        xanchor = "right",
        yanchor = "middle",
        font = list(size = 11)
      )
    )
  )

fig1 <- fig1 %>%
  add_lines(
    data = line_df,
    x = ~pm25,
    y = ~ev,
    inherit = FALSE,
    line = list(color = "red", width = 5),
    name = "LOESS trend"
  )

fig1

```

### Analysis of the Trends

1.  **Population Insight:** Bubble size represents state population, showing where EV adoption improvements would have the largest market impact.
2.  **Trend Line Insight:** The red LOESS curve reveals that EV adoption peaks at moderate pollution levels. At high PM2.5 levels, EV adoption drops sharply, indicating a weaker transition in the areas that need it most.
3.  **Structural Barriers:** Low EV adoption in highly polluted states suggests barriers such as limited charging infrastructure, weak incentives, or low awareness.
4.  **Strategic Opportunity for Tesla:** States in the High Pollution / Low EV Adoption quadrant represent underserved markets. Improving charging access in these regions could accelerate EV adoption and advance Tesla’s environmental mission.

::: scrolly
# Interactive Graph #3: The Rise of EV vs. Alternative Fuels
  ::: scrolly-body
 ::: {.scrolly-step data-step="1"}
**Key Question:** Is the infrastructure gap closing? How does the growth of EV charging stations compare to other alternative energy solutions (like CNG, Biodiesel, or Hydrogen)?
 :::
 ::: {.scrolly-step data-step="2"}
### Data Processing Strategy
To answer this, we aggregated data from the Department of Energy's historical station counts (2018–2023). The raw data presents a challenge: EV data is often formatted as a composite string (e.g., `"1,200 | 3,500"` representing Stations | Outlets), whereas other fuel types are simple integers.
 
The following code parses these strings to extract the unique **Station Count** (to ensure a fair comparison of locations, not plug counts) and categorizes them into "EV" (Tesla Red) and "Other Alternatives" (Greyscale) to visualize market dominance.
 :::
 ::: {.scrolly-step data-step="3"}
### Analysis of the Trends

This interactive visualization reveals a decisive trend in the alternative energy market:

1.  **The "Winner" is Clear:** The red trajectory (EVs) shows exponential growth, rising from ~20,000 stations to over 60,000 in just five years.
2.  **Stagnation of Competitors:** In sharp contrast, other alternative fuels such as CNG, Propane, and Biodiesel (the grey/black lines) have remained flat or stagnant.
3.  **Strategic Implication:** The "Alternative Fuel War" is effectively over. The data suggests that infrastructure investment has coalesced around Electric Vehicles. For Tesla, this validates the strategy of aggressive Supercharger expansion—we are not just competing; we are defining the new standard for accessibility.
 :::
  :::

  ::: scrolly-graphic
```{r}
# Function to read and process all fuel types from a sheet
process_fuel_sheet <- function(year, excel_path) {
  
  # Read sheet as text to handle symbols safely
  df <- suppressMessages(read_excel(excel_path, 
                                    sheet = as.character(year), 
                                    skip = 1, 
                                    col_types = "text"))
  
  # 1. Clean Column Names: Remove footnotes like 'a', 'b', 'c' (e.g., "Hydrogenb" -> "Hydrogen")
  # We convert to simple names for easier matching
  colnames(df)[1] <- "State"
  
  # Define the map of fuel types we want to find
  # Key = Display Name, Pattern = Regex to find column
  fuel_types <- list(
    "EV" = "Electric",
    "Biodiesel" = "Biodiesel",
    "CNG" = "CNG",
    "E85" = "E85",
    "Hydrogen" = "Hydrogen",
    "LNG" = "LNG",
    "Propane" = "Propane"
  )
  
  results <- list()
  
  for (type_name in names(fuel_types)) {
    pattern <- fuel_types[[type_name]]
    col_idx <- grep(pattern, colnames(df), ignore.case = TRUE)
    
    if (length(col_idx) > 0) {
      raw_col <- df[[col_idx[1]]] # Take the first match
      
      # Special handling for EV (Stations | Outlets)
      if (type_name == "EV") {
        clean_counts <- suppressWarnings(
          raw_col %>%
            str_split_fixed("\\|", 2) %>% 
            .[,1] %>%                     
            str_remove_all(",") %>%       
            as.numeric()
        )
      } else {
        # Standard handling for others (just remove commas)
        clean_counts <- suppressWarnings(
          raw_col %>%
            str_remove_all(",") %>%
            as.numeric()
        )
      }
      
      # Sum valid numbers (exclude Total row and NAs)
      total_count <- sum(clean_counts[!df$State %in% c("Total") & !is.na(clean_counts)])
      
      results[[type_name]] <- data.frame(Year = year, Type = type_name, Count = total_count)
    }
  }
  
  return(bind_rows(results))
}

# 1. Define file path
excel_file <- "historical-station-counts.xlsx" 

# 2. Loop through years 2018-2023
years <- 2018:2023
all_data_list <- list()

for (y in years) {
  tryCatch({
    all_data_list[[as.character(y)]] <- process_fuel_sheet(y, excel_file)
  }, error = function(e) { 
    message(paste("Skipping year", y, ":", e$message)) 
  })
}

# 3. Combine All Data
final_df <- bind_rows(all_data_list)
```

```{r}
#| label: plot-fuel-comparison

# Define Colors: EV gets Tesla Red, others get Greyscale/Black
colors_map <- c(
  "EV" = "#E82127",        # Tesla Red
  "Biodiesel" = "#555555",
  "CNG" = "#333333",
  "E85" = "#777777",
  "Hydrogen" = "#999999",
  "LNG" = "#BBBBBB",
  "Propane" = "#000000"    # Black
)

# Prepare the Plot
fig <- plot_ly(final_df, x = ~Year, y = ~Count, color = ~Type, colors = colors_map) %>%
  add_trace(type = 'scatter', mode = 'lines+markers', 
            line = list(width = 3), marker = list(size = 6),
            text = ~paste0("<b>", Type, "</b><br>Year: ", Year, "<br>Count: ", format(Count, big.mark = ",")),
            hoverinfo = "text")

# --- Create Dropdown Menu Buttons ---
# Button Logic: "visible" expects a boolean vector matching the order of traces.
# The order of traces depends on the alphabetical order of 'Type' usually, 
# or the order they appear in data.
# Types in data: Biodiesel, CNG, E85, EV, Hydrogen, LNG, Propane (7 types)
# We need to construct the boolean vectors carefully.

# Get unique types sorted (Plotly default sort)
types <- sort(unique(final_df$Type))
ev_index <- which(types == "EV") 

# Helper function to create visibility vector
# show_types: vector of types to show (e.g. c("EV", "CNG"))
create_visibility <- function(show_types) {
  as.list(types %in% show_types)
}

# Define Buttons
updatemenus <- list(
  list(
    y = 1.15,
    x = 0.1,
    type = "dropdown",
    active = 0,
    buttons = list(
      list(method = "restyle",
           args = list("visible", create_visibility(types)),
           label = "Show All"),
      list(method = "restyle",
           args = list("visible", create_visibility(c("EV", "E85"))),
           label = "EV vs E85"),
      list(method = "restyle",
           args = list("visible", create_visibility(c("EV", "CNG"))),
           label = "EV vs CNG"),
      list(method = "restyle",
           args = list("visible", create_visibility(c("EV", "Propane"))),
           label = "EV vs Propane"),
      list(method = "restyle",
           args = list("visible", create_visibility(c("EV", "Biodiesel"))),
           label = "EV vs Biodiesel")
    )
  )
)

# Apply Layout
fig <- fig %>% layout(
  title = list(text = "<b>Growth of EV vs. Other Alt. Fuels</b>", x = 0.05, y = 0.98),
  xaxis = list(title = "", showgrid = FALSE),
  yaxis = list(title = "Station Count", gridcolor = "#f2f2f2"),
  updatemenus = updatemenus,
  legend = list(x = 1, y = 0.5), # Move legend to side
  paper_bgcolor = "white",
  plot_bgcolor = "white",
  margin = list(t = 80) # Add top margin for dropdown
)

fig
```
 :::

:::

# Final Thoughts

# References cited {-}

[1] Electric vehicle registrations and consumption. Electric Vehicle Registrations and Consumption | Bureau of Transportation Statistics. (n.d.). https://www.bts.gov/browse-statistical-products-and-data/state-transportation-statistics/electric-vehicle-registrations 
[2] Environmental Protection Agency. (n.d.-a). Air Quality - Cities and Counties. EPA. https://www.epa.gov/air-trends/air-quality-cities-and-counties 
[3] Environmental Protection Agency. (n.d.-b). AirData website. EPA. https://aqs.epa.gov/aqsweb/documents/data_api.html 
[4] Fischer, J. (2025, November 26). Electric vehicle sales and market share (US - Q3 2025 updates). CarEdge. https://caredge.com/guides/electric-vehicle-market-share-and-sales#Q3_2025_EV_Sales_Totals_In_Progres 
[5] Fleck, A., & Richter, F. (2023, September 22). Infographic: Cars cause biggest share of Transportation co₂ emissions. Statista Daily Data. https://www.statista.com/chart/30890/estimated-share-of-co2-emissions-in-the-transportation-sector/ 
[6] Maps and data - electric vehicle registrations by State. Alternative Fuels Data Center: Maps and Data - Electric Vehicle Registrations by State. (n.d.). https://afdc.energy.gov/data/10962




# Submission --- reproducibility {-}


